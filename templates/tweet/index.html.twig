{% extends 'base.html.twig' %}

{% block title %}Tweet index{% endblock %}


{% block body %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/lucide-static@latest/font/lucide.css" />

<div class="bg-[#15202B] flex flex-row ">
    <div class="basis-1/3">
        <a class="bg-red-600 text-white p-3 rounded-full m-3 absolute bottom-0" href="{{ path('app_logout')}}">Se
            déconnecter</a>
    </div>

     <div class="pt-5 basis-1/3 flex items-center justify-center flex-col">

       

        <a class="bg-[#1DA1F2] text-white p-3 mb-4 rounded-full hover:bg-[#1A91DA]" href="{{ path('app_tweet_new') }}">
            Écrire un tweet
        </a>

        {% if tweets is not empty %}
        <div>

            {% for tweet in tweets %}
        
        
        <div
            class="relative p-4 bg-[#15202B] text-white border-x border-b first:border-t border-neutral-700 w-130 hover:bg-[#192734] transition">
            <div class="flex justify-between items-start">
                <div>
                    <span class="font-bold">{{ tweet.user.username }}</span>
                    <span class="text-neutral-500">·</span>
                    <span class="text-neutral-400">{{ tweet.createdAt|date('d/m/Y H:i', "Europe/Paris") }}</span>
                </div>

               

                <div class="relative">
                    <button type="button" class="text-neutral-400 hover:text-white"
                        onclick="toggleMenu('{{ tweet.id }}')">
                        ⋯
                    </button>

                    <div id="menu-{{ tweet.id }}"
                        class="hidden absolute right-0 mt-2 w-40 bg-[#192734] border border-neutral-700 rounded-lg shadow-lg z-10">
                        {% if app.user %}
                        {% set dejaSignale = false %}
                        {% for r in tweet.reports %}
                        {% if r.reported == app.user %}
                        {% set dejaSignale = true %}
                        {% endif %}
                        {% endfor %}

                        {% if dejaSignale %}
                        <button disabled class="w-full text-left px-4 py-2 text-neutral-400 cursor-not-allowed">
                            Déjà signalé
                        </button>
                        {% else %}
                        <form action="{{ path('app_report_form', {id: tweet.id}) }}" method="post" data-turbo="false">
                            <button type="submit" class="w-full text-left px-4 py-2 hover:bg-[#1A91DA] rounded">
                                Signaler
                            </button>
                        </form>
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="pt-3">
                <p>{{ tweet.content }}</p>
            </div>
             <div class="flex flex-row items-center mt-3">
                    <a id="likeBtn" href="{{ path('app_like_new', {'id':tweet.id})}}"
                        class="text-gray-400 hover:text-red-500 transition-colors duration-300">
                        <i class="fa-solid fa-heart fa-xs 
						{% for like in tweet.likes %}
							{% if app.user == like.user %}
								text-red-500
							{% endif %}
						{% endfor %}"></i>
                        <span class="text-white ml-1">{{ tweet.likes.count }}</span>
                    </a>
                    <a href="{{ path('app_retweet_add', {'id': tweet.id})}}"
                        class="ml-2 flex items-center w-fit h-fit hover:text-[#1DA1F2] transition-colors duration-300">
                        <i class="icon-repeat-2 rounded-lg p-1 
						{% for retweet in tweet.retweets %}
							{% if(app.user == retweet.user) %} text-[#1DA1F2] {% endif %}
						{% endfor %}"></i>
                        <span class="text-white ml-1">{{ tweet.retweets.count }}</span>
                    </a>
                </div>
        </div>
        
        {% endfor %}
        </div>
        {% else %}
        <span class="pt-5 text-neutral-400">Personne n'a encore écrit de tweet.</span>
        {% endif %}

    </div>
     <div class="basis-1/3">
    </div>
</div>

<script>
    function toggleMenu(id) {
        const menu = document.getElementById('menu-' + id);
        document.querySelectorAll('[id^="menu-"]').forEach(m => {
            if (m !== menu) m.classList.add('hidden');
        });
        menu.classList.toggle('hidden');
    }

    document.addEventListener('click', (e) => {
        if (!e.target.closest('[id^="menu-"]') && !e.target.closest('button[onclick^="toggleMenu"]')) {
            document.querySelectorAll('[id^="menu-"]').forEach(m => m.classList.add('hidden'));
        }
    });
</script>


{% endblock %}